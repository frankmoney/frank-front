// @flow

import React from 'react'
import { Drawer } from '@frankmoney/components'
import IconClose from '@frankmoney/components/lib/Drawer/IconClose'
import { injectStyles } from '@frankmoney/ui'
import { omitProps } from '@frankmoney/utils'
import cx from 'classnames'
import {
  compose,
  defaultProps,
  mapProps,
  setStatic,
  withProps,
} from 'recompose'
import Clamp from 'shiitake'
import Header from './Header'

const styles = {
  disabled: {},
  header: {
    display: 'flex',
  },
  headerTitle: {
    flex: 1,
  },
  headerButtons: {
    flex: 0,
  },
  headerButton: {
    marginLeft: 5,
    '&:not($disabled):hover': {
      color: '#000',
    },
  },
  headerMaximizeButton: {
    extend: 'headerButton',
  },
  headerCloseButton: {
    extend: 'headerButton',
  },
}

const defaultRenderHeaderTitle = ({ lineClamp, title }) => (
  <Clamp lines={lineClamp}>{title}</Clamp>
)

const defaultRenderHeaderMaximizeButton = ({ classes, disabled, onClick }) => (
  <IconMaximize
    className={cx(classes.headerMaximizeButton, disabled && classes.disabled)}
    onClick={disabled ? null : onClick}
  />
)

const defaultRenderHeaderCloseButton = ({ classes, disabled, onClick }) => (
  <IconClose
    className={cx(classes.headerCloseButton, disabled && classes.disabled)}
    onClick={disabled ? null : onClick}
  />
)

const defaultRenderHeaderButtons = ({
  classes,
  maximizeButtonShown,
  maximizeButtonDisabled,
  onMaximizeButtonClick,
  renderMaximizeButton,
  closeButtonShown,
  closeButtonDisabled,
  onCloseButtonClick,
  renderCloseButton,
}) => (
  <>
    {maximizeButtonShown &&
      renderMaximizeButton({
        classes,
        disabled: maximizeButtonDisabled,
        onClick: onMaximizeButtonClick,
      })}
    {closeButtonShown &&
      renderCloseButton({
        classes,
        disabled: closeButtonDisabled,
        onClick: onCloseButtonClick,
      })}
  </>
)

const defaultRenderHeader = ({
  classes,
  title,
  titleLineClamp,
  renderTitle,
  maximizeButtonShown,
  maximizeButtonDisabled,
  onMaximizeButtonClick,
  renderMaximizeButton,
  closeButtonShown,
  closeButtonDisabled,
  onCloseButtonClick,
  renderCloseButton,
  renderButtons,
}) => (
  <div className={classes.header}>
    <div className={classes.headerTitle}>
      {renderTitle({ titleLineClamp, title })}
    </div>
    <div className={classes.headerButtons}>
      {renderButtons({
        classes,
        maximizeButtonShown,
        maximizeButtonDisabled,
        onMaximizeButtonClick,
        renderMaximizeButton,
        closeButtonShown,
        closeButtonDisabled,
        onCloseButtonClick,
        renderCloseButton,
      })}
    </div>
  </div>
)

export default compose(
  injectStyles(styles),
  defaultProps({
    renderHeader: defaultRenderHeader,
    renderHeaderTitle: defaultRenderHeaderTitle,
    renderHeaderButtons: defaultRenderHeaderButtons,
    renderHeaderMaximizeButton: defaultRenderHeaderMaximizeButton,
    renderHeaderCloseButton: defaultRenderHeaderCloseButton,
  }),
  mapProps(({ classes, titleLineClamp, renderHeader }) => ({
    renderHeader: ({ classes: innerClasses, title, disableClose, onClose }) =>
      renderHeader({
        classes: {
          ...innerClasses,
          title: cx(classes.title, innerClasses.title),
        },
        title,
        titleLineClamp,
      }),
  })),
  withProps(({ classes: classesEx, titleClassName, titleLineClamp }) => ({
    renderTitle: args =>
      renderTitle({
        ...args,
        classesEx,
        titleClassName,
        titleLineClamp,
      }),
  })),
  omitProps('classes', 'titleClassName'),
  setStatic('Header', Header)
)(Drawer)
